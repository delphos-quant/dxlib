CREATE TABLE PESSOA
(
    CPF       VARCHAR(15) NOT NULL,
    NOME      VARCHAR(40) NOT NULL,
    DATA_NASC DATE,
    PCD       NUMBER(1),
    TIPO_USER CHAR(30)    NOT NULL,
  
  CONSTRAINT PK_PESSOA PRIMARY KEY (CPF),
  CONSTRAINT CHK_TIPO CHECK (UPPER(TIPO_USER) IN ('PROFESSOR', 'MONITOR', 'ALUNO', 'ADMINISTRADOR'))
);

CREATE TABLE PROFESSOR
(
    CPF                 VARCHAR(15) PRIMARY KEY,
    CARGO               VARCHAR(50),
    RUA                 VARCHAR(50),
    NUMERO              VARCHAR(10),
    CIDADE              VARCHAR(50),
    ORGAO_EMISSOR       VARCHAR(50),
    VALOR               NUMBER,
    AVALIACAO_DE_ALUNOS NUMBER,
    CONSTRAINT FK_PROFESSOR_PESSOA FOREIGN KEY (CPF) REFERENCES PESSOA (CPF)
);


CREATE TABLE ALUNO
(
    CPF                    VARCHAR(15) PRIMARY KEY,
    NIVEL                  NUMBER,
    SOCIALMENTE_VULNERAVEL VARCHAR(3),
    CONSTRAINT FK_ALUNO_PESSOA FOREIGN KEY (CPF) REFERENCES PESSOA (CPF) ON DELETE CASCADE
);

CREATE TABLE MONITOR
(
    CPF                 VARCHAR(15) PRIMARY KEY,
    AVALIACAO_DE_ALUNOS NUMBER,
    CONSTRAINT FK_MONITOR_PESSOA FOREIGN KEY (CPF) REFERENCES PESSOA (CPF) ON DELETE CASCADE
);

CREATE TABLE ADMINISTRADOR
(
    CPF VARCHAR(15) PRIMARY KEY,
    CONSTRAINT FK_ADMINISTRADOR_PESSOA FOREIGN KEY (CPF) REFERENCES PESSOA (CPF) ON DELETE CASCADE
);

CREATE TABLE AVALIA_PROFESSOR
(
    ALUNO     VARCHAR(15),
    PROFESSOR VARCHAR(15),
    NOTA      NUMBER(1, 0),
    CONSTRAINT PK_AVALIA_PROFESSOR PRIMARY KEY (ALUNO, PROFESSOR),
    CONSTRAINT FK_AVALIA_PROFESSOR_ALUNO FOREIGN KEY (ALUNO) REFERENCES ALUNO (CPF) ON DELETE CASCADE,
    CONSTRAINT FK_AVALIA_PROFESSOR_PROFESSOR FOREIGN KEY (PROFESSOR) REFERENCES PROFESSOR (CPF) ON DELETE CASCADE,
    CONSTRAINT CHK_AVALIA_PROFESSOR_NOTA CHECK (NOTA >= 0 AND NOTA <= 5)
);

CREATE TABLE AVALIA_MONITOR
(
    ALUNO   VARCHAR(15),
    MONITOR VARCHAR(15),
    NOTA    NUMBER(1, 0),
    CONSTRAINT PK_AVALIA_MONITOR PRIMARY KEY (ALUNO, MONITOR),
    CONSTRAINT FK_AVALIA_MONITOR_ALUNO FOREIGN KEY (ALUNO) REFERENCES ALUNO (CPF) ON DELETE CASCADE,
    CONSTRAINT FK_AVALIA_MONITOR_MONITOR FOREIGN KEY (MONITOR) REFERENCES MONITOR (CPF) ON DELETE CASCADE,
    CONSTRAINT CHK_AVALIA_MONITOR_NOTA CHECK (NOTA >= 0 AND NOTA <= 5)
);

CREATE TABLE CURSO
(
    NOME          VARCHAR(15) PRIMARY KEY,
    DESCRICAO     VARCHAR(255),
    LIMITE_ALUNOS NUMBER,
    PROFESSOR     VARCHAR(15),
    NOME_FORUM    VARCHAR(30),
    CONSTRAINT FK_CURSO_PROFESSOR FOREIGN KEY (PROFESSOR) REFERENCES PROFESSOR (CPF) ON DELETE CASCADE
);

CREATE TABLE REQUISITOS
(
    CURSO     VARCHAR(15),
    REQUISITO VARCHAR(50),
    CONSTRAINT PK_REQUISITOS PRIMARY KEY (CURSO, REQUISITO),
    CONSTRAINT FK_REQUISITOS_CURSO FOREIGN KEY (CURSO) REFERENCES CURSO (NOME) ON DELETE CASCADE
);

CREATE TABLE AUXILIA
(
    MONITOR VARCHAR(15),
    CURSO   VARCHAR(15),
    CONSTRAINT PK_AUXILIA PRIMARY KEY (MONITOR, CURSO),
    CONSTRAINT FK_AUXILIA_MONITOR FOREIGN KEY (MONITOR) REFERENCES MONITOR (CPF) ON DELETE CASCADE,
    CONSTRAINT FK_AUXILIA_CURSO FOREIGN KEY (CURSO) REFERENCES CURSO (NOME) ON DELETE CASCADE
);

CREATE TABLE PARTICIPA_RANKING
(
    ALUNO  VARCHAR(15) NOT NULL,
    CURSO  VARCHAR(15) NOT NULL,
    STREAK NUMBER DEFAULT 0,
    CONSTRAINT PK_PARTICIPA_RANKING PRIMARY KEY (ALUNO, CURSO),
    CONSTRAINT FK_PARTICIPA_RANKING_ALUNO FOREIGN KEY (ALUNO) REFERENCES ALUNO (CPF) ON DELETE CASCADE,
    CONSTRAINT FK_PARTICIPA_RANKING_CURSO FOREIGN KEY (CURSO) REFERENCES CURSO (NOME) ON DELETE CASCADE
);

CREATE TABLE HORARIO_MINISTRA
(
    CURSO   VARCHAR(15),
    HORARIO VARCHAR(20),
    CONSTRAINT PK_HORARIO_CURSO PRIMARY KEY (CURSO, HORARIO),
    CONSTRAINT FK_HORARIO_CURSO_CURSO FOREIGN KEY (CURSO) REFERENCES CURSO (NOME) ON DELETE CASCADE
);


CREATE TABLE RECURSO_MINISTRA
(
    CURSO   VARCHAR(15),
    RECURSO VARCHAR(40),
    CONSTRAINT PK_CURSO_RECURSOS PRIMARY KEY (CURSO, RECURSO),
    CONSTRAINT FK_CURSO_RECURSOS_CURSO FOREIGN KEY (CURSO) REFERENCES CURSO (NOME) ON DELETE CASCADE
);

CREATE TABLE PUBLICACAO
(
    PESSOA              VARCHAR(15)  NOT NULL,
    EPOCA               DATE,
    CURSO               VARCHAR(15),
    CONTEUDO            VARCHAR(500) NOT NULL,
    PESSOA_REFERENCIADA VARCHAR(15),
    EPOCA_REFERENCIADA  DATE,
    CURSO_REFERENCIADO  VARCHAR(15),
    CONSTRAINT PK_PUBLICACAO PRIMARY KEY (PESSOA, EPOCA, CURSO),
    CONSTRAINT FK_PUBLICACAO_PESSOA FOREIGN KEY (PESSOA_REFERENCIADA, EPOCA_REFERENCIADA, CURSO_REFERENCIADO) REFERENCES PUBLICACAO (PESSOA, EPOCA, CURSO) ON DELETE CASCADE,
    CONSTRAINT FK_PUBLICACAO_PESSOA2 FOREIGN KEY (CURSO) REFERENCES CURSO (NOME) ON DELETE CASCADE,
    CONSTRAINT FK_PUBLICACAO_PESSOA3 FOREIGN KEY (PESSOA) REFERENCES PESSOA (CPF) ON DELETE CASCADE
);

CREATE TABLE JORNADA_DE_PROGRESSO
(
    CURSO                VARCHAR(15) NOT NULL,
    ALUNO                VARCHAR(15) NOT NULL,
    NIVEL_DE_APRENDIZADO NUMBER,
    CONSTRAINT PK_JORNADA_DE_PROGRESSO PRIMARY KEY (CURSO, ALUNO),
    CONSTRAINT FK_JORNADA_DE_PROGRESSO FOREIGN KEY (ALUNO) REFERENCES ALUNO (CPF) ON DELETE CASCADE
);

CREATE TABLE MISSAO
(
    CURSO       VARCHAR(15) NOT NULL,
    NOME        VARCHAR(15) NOT NULL,
    DESCRICAO   VARCHAR(100),
    EXPERIENCIA NUMBER      NOT NULL,
    DIFICULDADE VARCHAR(10),
    DURACAO     VARCHAR(10),
    CONSTRAINT PK_MISSAO PRIMARY KEY (CURSO, NOME),
    CONSTRAINT FK1_MISSAO FOREIGN KEY (CURSO) REFERENCES CURSO (NOME) ON DELETE CASCADE
);

CREATE TABLE JORNADA_CONTEM_MISSAO
(
    CURSO_JORNADA VARCHAR(15) NOT NULL,
    ALUNO_JORNADA VARCHAR(15) NOT NULL,
    CURSO_MISSAO  VARCHAR(15) NOT NULL,
    NOME_MISSAO   VARCHAR(15) NOT NULL,
    FINALIZADA    NUMBER(1),
    CONSTRAINT PK_JORNADA_CONTEM_MISSAO PRIMARY KEY (CURSO_JORNADA, ALUNO_JORNADA, CURSO_MISSAO, NOME_MISSAO),
    CONSTRAINT FK1_JORNADA_CONTEM_MISSAO FOREIGN KEY (CURSO_JORNADA, ALUNO_JORNADA) REFERENCES JORNADA_DE_PROGRESSO (CURSO, ALUNO) ON DELETE CASCADE,
    CONSTRAINT FK2_JORNADA_CONTEM_MISSAO FOREIGN KEY (CURSO_MISSAO, NOME_MISSAO) REFERENCES MISSAO (CURSO, NOME) ON DELETE CASCADE
);

CREATE TABLE FAZ
(
    ALUNO  VARCHAR(15) NOT NULL,
    CURSO  VARCHAR(15) NOT NULL,
    MISSAO VARCHAR(15) NOT NULL,
    EPOCA  DATE, -- horario em que foi feita a missao
    CONSTRAINT PK_FAZ PRIMARY KEY (ALUNO, CURSO, MISSAO),
    CONSTRAINT FK1_FAZ FOREIGN KEY (ALUNO) REFERENCES ALUNO (CPF) ON DELETE CASCADE,
    CONSTRAINT FK2_FAZ FOREIGN KEY (CURSO, MISSAO) REFERENCES MISSAO (CURSO, NOME) ON DELETE CASCADE
);








